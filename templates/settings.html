<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - CertMate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#1e40af',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-shield-alt text-primary text-2xl"></i>
                    </div>
                    <div class="ml-3">
                        <h1 class="text-xl font-semibold text-gray-900">CertMate</h1>
                        <p class="text-sm text-gray-500">SSL Certificate Manager</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/" class="px-3 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100">
                        <i class="fas fa-certificate mr-1"></i> Certificates
                    </a>
                    <a href="/settings" class="px-3 py-2 rounded-md text-sm font-medium text-primary bg-blue-50 border border-blue-200">
                        <i class="fas fa-cog mr-1"></i> Settings
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="bg-white shadow rounded-lg mb-6">
            <div class="px-6 py-4">
                <h2 class="text-2xl font-bold text-gray-900">Settings</h2>
                <p class="text-gray-600 mt-1">Configure your DNS provider credentials and preferences</p>
                <div class="mt-3 flex items-center text-sm">
                    <div class="flex items-center text-green-600" id="connectionStatus" style="display: none;">
                        <i class="fas fa-check-circle mr-1"></i>
                        <span>Connected and configured</span>
                    </div>
                    <div class="flex items-center text-yellow-600" id="partialStatus" style="display: none;">
                        <i class="fas fa-exclamation-triangle mr-1"></i>
                        <span>Partially configured</span>
                    </div>
                    <div class="flex items-center text-red-600" id="disconnectedStatus" style="display: none;">
                        <i class="fas fa-times-circle mr-1"></i>
                        <span>Not configured</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Form -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b">
                <h3 class="text-lg font-medium text-gray-900">Configuration</h3>
            </div>
            <div class="px-6 py-6">
                <form id="settingsForm" class="space-y-8">
                    
                    <!-- DNS Provider Selection -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            <i class="fas fa-server mr-1"></i>
                            DNS Provider
                        </label>
                        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-3">
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="cloudflare" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fab fa-cloudflare text-2xl text-orange-500 mb-2"></i>
                                        <div class="text-sm font-medium">Cloudflare</div>
                                        <div class="text-xs text-gray-500 mt-1" id="cloudflare-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="route53" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fab fa-aws text-2xl text-orange-400 mb-2"></i>
                                        <div class="text-sm font-medium">Route53</div>
                                        <div class="text-xs text-gray-500 mt-1" id="route53-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="azure" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fab fa-microsoft text-2xl text-blue-600 mb-2"></i>
                                        <div class="text-sm font-medium">Azure DNS</div>
                                        <div class="text-xs text-gray-500 mt-1" id="azure-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="google" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fab fa-google text-2xl text-blue-500 mb-2"></i>
                                        <div class="text-sm font-medium">Google DNS</div>
                                        <div class="text-xs text-gray-500 mt-1" id="google-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="powerdns" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fas fa-server text-2xl text-gray-600 mb-2"></i>
                                        <div class="text-sm font-medium">PowerDNS</div>
                                        <div class="text-xs text-gray-500 mt-1" id="powerdns-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="digitalocean" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fab fa-digital-ocean text-2xl text-blue-600 mb-2"></i>
                                        <div class="text-sm font-medium">DigitalOcean</div>
                                        <div class="text-xs text-gray-500 mt-1" id="digitalocean-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="linode" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fas fa-cloud text-2xl text-green-600 mb-2"></i>
                                        <div class="text-sm font-medium">Linode</div>
                                        <div class="text-xs text-gray-500 mt-1" id="linode-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="gandi" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fas fa-globe text-2xl text-orange-600 mb-2"></i>
                                        <div class="text-sm font-medium">Gandi</div>
                                        <div class="text-xs text-gray-500 mt-1" id="gandi-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="ovh" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fas fa-server text-2xl text-purple-600 mb-2"></i>
                                        <div class="text-sm font-medium">OVH</div>
                                        <div class="text-xs text-gray-500 mt-1" id="ovh-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="namecheap" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fas fa-shopping-cart text-2xl text-red-600 mb-2"></i>
                                        <div class="text-sm font-medium">Namecheap</div>
                                        <div class="text-xs text-gray-500 mt-1" id="namecheap-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="vultr" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fas fa-cloud text-2xl text-blue-600 mb-2"></i>
                                        <div class="text-sm font-medium">Vultr</div>
                                        <div class="text-xs text-gray-500 mt-1" id="vultr-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="dnsmadeeasy" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fas fa-cogs text-2xl text-green-600 mb-2"></i>
                                        <div class="text-sm font-medium">DNS Made Easy</div>
                                        <div class="text-xs text-gray-500 mt-1" id="dnsmadeeasy-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="nsone" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fas fa-network-wired text-2xl text-indigo-600 mb-2"></i>
                                        <div class="text-sm font-medium">NS1</div>
                                        <div class="text-xs text-gray-500 mt-1" id="nsone-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="rfc2136" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fas fa-exchange-alt text-2xl text-gray-600 mb-2"></i>
                                        <div class="text-sm font-medium">RFC2136</div>
                                        <div class="text-xs text-gray-500 mt-1" id="rfc2136-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                        </div>

                        <!-- Tier 3: Extended Providers -->
                        <h3 class="text-sm font-medium text-gray-900 mb-3 border-b border-gray-200 pb-2 mt-6">
                            <i class="fas fa-expand-arrows-alt mr-2 text-blue-600"></i>
                            Tier 3: Extended Providers
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="hetzner" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fas fa-server text-2xl text-red-600 mb-2"></i>
                                        <div class="text-sm font-medium">Hetzner</div>
                                        <div class="text-xs text-gray-500 mt-1" id="hetzner-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="porkbun" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fas fa-paw text-2xl text-pink-600 mb-2"></i>
                                        <div class="text-sm font-medium">Porkbun</div>
                                        <div class="text-xs text-gray-500 mt-1" id="porkbun-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="godaddy" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fas fa-globe text-2xl text-green-600 mb-2"></i>
                                        <div class="text-sm font-medium">GoDaddy</div>
                                        <div class="text-xs text-gray-500 mt-1" id="godaddy-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="he-ddns" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fas fa-bolt text-2xl text-yellow-600 mb-2"></i>
                                        <div class="text-sm font-medium">Hurricane Electric</div>
                                        <div class="text-xs text-gray-500 mt-1" id="he-ddns-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="dns_provider" value="dynudns" class="sr-only peer">
                                <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 hover:border-gray-300">
                                    <div class="text-center">
                                        <i class="fas fa-sync-alt text-2xl text-purple-600 mb-2"></i>
                                        <div class="text-sm font-medium">Dynu</div>
                                        <div class="text-xs text-gray-500 mt-1" id="dynudns-status">Not configured</div>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- DNS Provider Configurations -->
                    <!-- Cloudflare Configuration -->
                    <div id="cloudflare-config" class="dns-config hidden">
                        <div class="border border-orange-200 rounded-lg p-4 bg-orange-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fab fa-cloudflare mr-2 text-orange-500"></i>
                                Cloudflare Configuration
                            </h4>
                            <div>
                                <label for="cloudflare_api_token" class="block text-sm font-medium text-gray-700">
                                    API Token
                                </label>
                                <div class="mt-1">
                                    <input type="password" id="cloudflare_api_token" name="cloudflare_api_token" 
                                           class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Enter your Cloudflare API token">
                                </div>
                                <p class="mt-2 text-sm text-gray-600">
                                    Create an API token at <a href="https://dash.cloudflare.com/profile/api-tokens" target="_blank" class="text-primary hover:underline">Cloudflare Dashboard</a> with <strong>Zone:DNS:Edit</strong> permissions.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- AWS Route53 Configuration -->
                    <div id="route53-config" class="dns-config hidden">
                        <div class="border border-orange-200 rounded-lg p-4 bg-orange-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fab fa-aws mr-2 text-orange-400"></i>
                                AWS Route53 Configuration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="route53_access_key_id" class="block text-sm font-medium text-gray-700">
                                        Access Key ID
                                    </label>
                                    <input type="password" id="route53_access_key_id" name="route53_access_key_id" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="AKIAIOSFODNN7EXAMPLE">
                                </div>
                                <div>
                                    <label for="route53_secret_access_key" class="block text-sm font-medium text-gray-700">
                                        Secret Access Key
                                    </label>
                                    <input type="password" id="route53_secret_access_key" name="route53_secret_access_key" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY">
                                </div>
                                <div>
                                    <label for="route53_region" class="block text-sm font-medium text-gray-700">
                                        Region (Optional)
                                    </label>
                                    <input type="text" id="route53_region" name="route53_region" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="us-east-1" value="us-east-1">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Create IAM credentials with <strong>Route53FullAccess</strong> policy or a custom policy with Route53 DNS permissions.
                            </p>
                        </div>
                    </div>

                    <!-- Azure DNS Configuration -->
                    <div id="azure-config" class="dns-config hidden">
                        <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fab fa-microsoft mr-2 text-blue-600"></i>
                                Azure DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="azure_subscription_id" class="block text-sm font-medium text-gray-700">
                                        Subscription ID
                                    </label>
                                    <input type="text" id="azure_subscription_id" name="azure_subscription_id" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="12345678-1234-1234-1234-123456789012">
                                </div>
                                <div>
                                    <label for="azure_resource_group" class="block text-sm font-medium text-gray-700">
                                        Resource Group
                                    </label>
                                    <input type="text" id="azure_resource_group" name="azure_resource_group" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="my-dns-resource-group">
                                </div>
                                <div>
                                    <label for="azure_tenant_id" class="block text-sm font-medium text-gray-700">
                                        Tenant ID
                                    </label>
                                    <input type="text" id="azure_tenant_id" name="azure_tenant_id" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="12345678-1234-1234-1234-123456789012">
                                </div>
                                <div>
                                    <label for="azure_client_id" class="block text-sm font-medium text-gray-700">
                                        Client ID
                                    </label>
                                    <input type="text" id="azure_client_id" name="azure_client_id" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="12345678-1234-1234-1234-123456789012">
                                </div>
                                <div class="md:col-span-2">
                                    <label for="azure_client_secret" class="block text-sm font-medium text-gray-700">
                                        Client Secret
                                    </label>
                                    <input type="password" id="azure_client_secret" name="azure_client_secret" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Azure client secret">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Create a Service Principal with <strong>DNS Zone Contributor</strong> role for your DNS zones.
                            </p>
                        </div>
                    </div>

                    <!-- Google Cloud DNS Configuration -->
                    <div id="google-config" class="dns-config hidden">
                        <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fab fa-google mr-2 text-blue-500"></i>
                                Google Cloud DNS Configuration
                            </h4>
                            <div class="space-y-4">
                                <div>
                                    <label for="google_project_id" class="block text-sm font-medium text-gray-700">
                                        Project ID
                                    </label>
                                    <input type="text" id="google_project_id" name="google_project_id" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="my-gcp-project-123456">
                                </div>
                                <div>
                                    <label for="google_service_account_key" class="block text-sm font-medium text-gray-700">
                                        Service Account JSON Key
                                    </label>
                                    <textarea id="google_service_account_key" name="google_service_account_key" rows="4"
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder='{"type": "service_account", "project_id": "...", ...}'></textarea>
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Create a Service Account with <strong>DNS Administrator</strong> role and download the JSON key file.
                            </p>
                        </div>
                    </div>

                    <!-- PowerDNS Configuration -->
                    <div id="powerdns-config" class="dns-config hidden">
                        <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-server mr-2 text-gray-600"></i>
                                PowerDNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="powerdns_api_url" class="block text-sm font-medium text-gray-700">
                                        API URL
                                    </label>
                                    <input type="url" id="powerdns_api_url" name="powerdns_api_url" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="https://powerdns.example.com:8081">
                                </div>
                                <div>
                                    <label for="powerdns_api_key" class="block text-sm font-medium text-gray-700">
                                        API Key
                                    </label>
                                    <input type="password" id="powerdns_api_key" name="powerdns_api_key" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your PowerDNS API key">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Configure your PowerDNS server with API access enabled and provide the API endpoint and key.
                            </p>
                        </div>
                    </div>

                    <!-- DigitalOcean Configuration -->
                    <div id="digitalocean-config" class="dns-config hidden">
                        <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fab fa-digital-ocean mr-2 text-blue-600"></i>
                                DigitalOcean DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 gap-4">
                                <div>
                                    <label for="digitalocean_api_token" class="block text-sm font-medium text-gray-700">
                                        API Token
                                    </label>
                                    <input type="password" id="digitalocean_api_token" name="digitalocean_api_token" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your DigitalOcean API token">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Generate a personal access token from your DigitalOcean control panel with read/write permissions for DNS.
                            </p>
                        </div>
                    </div>

                    <!-- Linode Configuration -->
                    <div id="linode-config" class="dns-config hidden">
                        <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-cloud mr-2 text-green-600"></i>
                                Linode DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 gap-4">
                                <div>
                                    <label for="linode_api_key" class="block text-sm font-medium text-gray-700">
                                        API Key
                                    </label>
                                    <input type="password" id="linode_api_key" name="linode_api_key" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Linode API key">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Create a personal access token from your Linode account with read/write access to DNS records.
                            </p>
                        </div>
                    </div>

                    <!-- Gandi Configuration -->
                    <div id="gandi-config" class="dns-config hidden">
                        <div class="border border-orange-200 rounded-lg p-4 bg-orange-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-globe mr-2 text-orange-600"></i>
                                Gandi DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 gap-4">
                                <div>
                                    <label for="gandi_api_token" class="block text-sm font-medium text-gray-700">
                                        API Token
                                    </label>
                                    <input type="password" id="gandi_api_token" name="gandi_api_token" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Gandi LiveDNS API token">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Generate a personal access token from your Gandi account with DNS access permissions.
                            </p>
                        </div>
                    </div>

                    <!-- OVH Configuration -->
                    <div id="ovh-config" class="dns-config hidden">
                        <div class="border border-purple-200 rounded-lg p-4 bg-purple-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-server mr-2 text-purple-600"></i>
                                OVH DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="ovh_endpoint" class="block text-sm font-medium text-gray-700">
                                        Endpoint
                                    </label>
                                    <select id="ovh_endpoint" name="ovh_endpoint" 
                                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary">
                                        <option value="">Select endpoint</option>
                                        <option value="ovh-eu">ovh-eu (Europe)</option>
                                        <option value="ovh-us">ovh-us (US)</option>
                                        <option value="ovh-ca">ovh-ca (Canada)</option>
                                        <option value="kimsufi-eu">kimsufi-eu</option>
                                        <option value="kimsufi-ca">kimsufi-ca</option>
                                        <option value="soyoustart-eu">soyoustart-eu</option>
                                        <option value="soyoustart-ca">soyoustart-ca</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="ovh_application_key" class="block text-sm font-medium text-gray-700">
                                        Application Key
                                    </label>
                                    <input type="password" id="ovh_application_key" name="ovh_application_key" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your application key">
                                </div>
                                <div>
                                    <label for="ovh_application_secret" class="block text-sm font-medium text-gray-700">
                                        Application Secret
                                    </label>
                                    <input type="password" id="ovh_application_secret" name="ovh_application_secret" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your application secret">
                                </div>
                                <div>
                                    <label for="ovh_consumer_key" class="block text-sm font-medium text-gray-700">
                                        Consumer Key
                                    </label>
                                    <input type="password" id="ovh_consumer_key" name="ovh_consumer_key" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your consumer key">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Create an OVH application with DNS access permissions and configure the API credentials.
                            </p>
                        </div>
                    </div>

                    <!-- Namecheap Configuration -->
                    <div id="namecheap-config" class="dns-config hidden">
                        <div class="border border-red-200 rounded-lg p-4 bg-red-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-shopping-cart mr-2 text-red-600"></i>
                                Namecheap DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="namecheap_username" class="block text-sm font-medium text-gray-700">
                                        Username
                                    </label>
                                    <input type="text" id="namecheap_username" name="namecheap_username" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Namecheap username">
                                </div>
                                <div>
                                    <label for="namecheap_api_key" class="block text-sm font-medium text-gray-700">
                                        API Key
                                    </label>
                                    <input type="password" id="namecheap_api_key" name="namecheap_api_key" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Namecheap API key">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Enable API access in your Namecheap account and provide your username and API key.
                            </p>
                        </div>
                    </div>

                    <!-- RFC2136 Configuration -->
                    <div id="rfc2136-config" class="dns-config hidden">
                        <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-exchange-alt mr-2 text-gray-600"></i>
                                RFC2136 DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="rfc2136_nameserver" class="block text-sm font-medium text-gray-700">
                                        Nameserver
                                    </label>
                                    <input type="text" id="rfc2136_nameserver" name="rfc2136_nameserver" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="ns.example.com">
                                </div>
                                <div>
                                    <label for="rfc2136_tsig_key" class="block text-sm font-medium text-gray-700">
                                        TSIG Key Name
                                    </label>
                                    <input type="text" id="rfc2136_tsig_key" name="rfc2136_tsig_key" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="mykey">
                                </div>
                                <div>
                                    <label for="rfc2136_tsig_secret" class="block text-sm font-medium text-gray-700">
                                        TSIG Secret
                                    </label>
                                    <input type="password" id="rfc2136_tsig_secret" name="rfc2136_tsig_secret" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Base64-encoded secret">
                                </div>
                                <div>
                                    <label for="rfc2136_tsig_algorithm" class="block text-sm font-medium text-gray-700">
                                        TSIG Algorithm (Optional)
                                    </label>
                                    <select id="rfc2136_tsig_algorithm" name="rfc2136_tsig_algorithm" 
                                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary">
                                        <option value="">Default (HMAC-MD5)</option>
                                        <option value="HMAC-MD5">HMAC-MD5</option>
                                        <option value="HMAC-SHA1">HMAC-SHA1</option>
                                        <option value="HMAC-SHA224">HMAC-SHA224</option>
                                        <option value="HMAC-SHA256">HMAC-SHA256</option>
                                        <option value="HMAC-SHA384">HMAC-SHA384</option>
                                        <option value="HMAC-SHA512">HMAC-SHA512</option>
                                    </select>
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Configure RFC2136 dynamic DNS updates for BIND or compatible DNS servers.
                            </p>
                        </div>
                    </div>

                    <!-- Tier 3 Provider Configurations -->
                    
                    <!-- Hetzner Configuration -->
                    <div id="hetzner-config" class="dns-config hidden">
                        <div class="border border-red-200 rounded-lg p-4 bg-red-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-server mr-2 text-red-600"></i>
                                Hetzner DNS Configuration
                            </h4>
                            <div>
                                <label for="hetzner_api_token" class="block text-sm font-medium text-gray-700">
                                    API Token
                                </label>
                                <input type="password" id="hetzner_api_token" name="hetzner_api_token" 
                                       class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                       placeholder="Your Hetzner DNS API token">
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Create an API token at <a href="https://dns.hetzner.com/" target="_blank" class="text-primary hover:underline">Hetzner DNS Console</a> with DNS zone permissions.
                            </p>
                        </div>
                    </div>

                    <!-- Porkbun Configuration -->
                    <div id="porkbun-config" class="dns-config hidden">
                        <div class="border border-pink-200 rounded-lg p-4 bg-pink-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-paw mr-2 text-pink-600"></i>
                                Porkbun DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="porkbun_api_key" class="block text-sm font-medium text-gray-700">
                                        API Key
                                    </label>
                                    <input type="password" id="porkbun_api_key" name="porkbun_api_key" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Porkbun API key">
                                </div>
                                <div>
                                    <label for="porkbun_secret_key" class="block text-sm font-medium text-gray-700">
                                        Secret Key
                                    </label>
                                    <input type="password" id="porkbun_secret_key" name="porkbun_secret_key" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Porkbun secret key">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Get your API credentials from <a href="https://porkbun.com/account/api" target="_blank" class="text-primary hover:underline">Porkbun API page</a>.
                            </p>
                        </div>
                    </div>

                    <!-- GoDaddy Configuration -->
                    <div id="godaddy-config" class="dns-config hidden">
                        <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-globe mr-2 text-green-600"></i>
                                GoDaddy DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="godaddy_api_key" class="block text-sm font-medium text-gray-700">
                                        API Key
                                    </label>
                                    <input type="password" id="godaddy_api_key" name="godaddy_api_key" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your GoDaddy API key">
                                </div>
                                <div>
                                    <label for="godaddy_secret" class="block text-sm font-medium text-gray-700">
                                        API Secret
                                    </label>
                                    <input type="password" id="godaddy_secret" name="godaddy_secret" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your GoDaddy API secret">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Create API credentials at <a href="https://developer.godaddy.com/keys" target="_blank" class="text-primary hover:underline">GoDaddy Developer Portal</a>.
                            </p>
                        </div>
                    </div>

                    <!-- Hurricane Electric Configuration -->
                    <div id="he-ddns-config" class="dns-config hidden">
                        <div class="border border-yellow-200 rounded-lg p-4 bg-yellow-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-bolt mr-2 text-yellow-600"></i>
                                Hurricane Electric DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="he_ddns_username" class="block text-sm font-medium text-gray-700">
                                        Username
                                    </label>
                                    <input type="text" id="he_ddns_username" name="he_ddns_username" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Hurricane Electric username">
                                </div>
                                <div>
                                    <label for="he_ddns_password" class="block text-sm font-medium text-gray-700">
                                        Password
                                    </label>
                                    <input type="password" id="he_ddns_password" name="he_ddns_password" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Hurricane Electric password">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Use your <a href="https://dns.he.net/" target="_blank" class="text-primary hover:underline">Hurricane Electric DNS</a> account credentials.
                            </p>
                        </div>
                    </div>

                    <!-- Dynu Configuration -->
                    <div id="dynudns-config" class="dns-config hidden">
                        <div class="border border-purple-200 rounded-lg p-4 bg-purple-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-sync-alt mr-2 text-purple-600"></i>
                                Dynu DNS Configuration
                            </h4>
                            <div>
                                <label for="dynudns_token" class="block text-sm font-medium text-gray-700">
                                    API Token
                                </label>
                                <input type="password" id="dynudns_token" name="dynudns_token" 
                                       class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                       placeholder="Your Dynu API token">
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Generate an API token at <a href="https://www.dynu.com/en-US/ControlPanel/APICredentials" target="_blank" class="text-primary hover:underline">Dynu Control Panel</a>.
                            </p>
                        </div>
                    </div>

                    <!-- Vultr Configuration -->
                    <div id="vultr-config" class="dns-config hidden">
                        <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-cloud mr-2 text-blue-600"></i>
                                Vultr DNS Configuration
                            </h4>
                            <div>
                                <label for="vultr_api_key" class="block text-sm font-medium text-gray-700">
                                    API Key
                                </label>
                                <input type="password" id="vultr_api_key" name="vultr_api_key" 
                                       class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                       placeholder="Your Vultr API key">
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Generate an API key in your Vultr account with DNS permissions.
                            </p>
                        </div>
                    </div>

                    <!-- DNS Made Easy Configuration -->
                    <div id="dnsmadeeasy-config" class="dns-config hidden">
                        <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-cogs mr-2 text-green-600"></i>
                                DNS Made Easy Configuration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="dnsmadeeasy_api_key" class="block text-sm font-medium text-gray-700">
                                        API Key
                                    </label>
                                    <input type="password" id="dnsmadeeasy_api_key" name="dnsmadeeasy_api_key" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your DNS Made Easy API key">
                                </div>
                                <div>
                                    <label for="dnsmadeeasy_secret_key" class="block text-sm font-medium text-gray-700">
                                        Secret Key
                                    </label>
                                    <input type="password" id="dnsmadeeasy_secret_key" name="dnsmadeeasy_secret_key" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your DNS Made Easy secret key">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Create API credentials in your DNS Made Easy account with DNS management permissions.
                            </p>
                        </div>
                    </div>

                    <!-- NS1 Configuration -->
                    <div id="nsone-config" class="dns-config hidden">
                        <div class="border border-indigo-200 rounded-lg p-4 bg-indigo-50">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-network-wired mr-2 text-indigo-600"></i>
                                NS1 DNS Configuration
                            </h4>
                            <div>
                                <label for="nsone_api_key" class="block text-sm font-medium text-gray-700">
                                    API Key
                                </label>
                                <input type="password" id="nsone_api_key" name="nsone_api_key" 
                                       class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                       placeholder="Your NS1 API key">
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Generate an API key in your NS1 account with DNS record management permissions.
                            </p>
                        </div>
                    </div>

                    <!-- Basic Settings -->
                    <div class="border-t pt-6">
                        <h4 class="text-lg font-medium text-gray-900 mb-4">Basic Settings</h4>
                        
                        <!-- Email -->
                        <div class="mb-6">
                            <label for="email" class="block text-sm font-medium text-gray-700">
                                <i class="fas fa-envelope mr-1"></i>
                                Email Address
                            </label>
                            <div class="mt-1">
                                <input type="email" id="email" name="email" 
                                       class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                       placeholder="your@email.com" required>
                            </div>
                            <p class="mt-2 text-sm text-gray-500">
                                Used for Let's Encrypt registration and renewal notifications.
                            </p>
                        </div>

                        <!-- Domains -->
                        <div class="mb-6">
                            <label for="domains" class="block text-sm font-medium text-gray-700">
                                <i class="fas fa-globe mr-1"></i>
                                Domains
                            </label>
                            <div class="mt-1">
                                <textarea id="domains" name="domains" rows="3"
                                       class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                       placeholder="example.com&#10;anotherdomain.com&#10;One domain per line"></textarea>
                            </div>
                            <p class="mt-2 text-sm text-gray-500">
                                Enter one domain per line. Certificates will be created for each domain with wildcard support (*.domain.com).
                            </p>
                        </div>

                        <!-- Auto Renewal -->
                        <div class="mb-6">
                            <div class="flex items-center">
                                <input type="checkbox" id="auto_renew" name="auto_renew" 
                                       class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                                <label for="auto_renew" class="ml-2 block text-sm text-gray-900">
                                    Enable automatic certificate renewal
                                </label>
                            </div>
                            <p class="mt-2 text-sm text-gray-500 ml-6">
                                Certificates will be automatically renewed when they have 30 days or less until expiration.
                            </p>
                        </div>

                        <!-- API Bearer Token -->
                        <div class="mb-6">
                            <label for="api_bearer_token" class="block text-sm font-medium text-gray-700">
                                <i class="fas fa-key mr-1"></i>
                                API Bearer Token
                            </label>
                            <div class="mt-1">
                                <input type="password" id="api_bearer_token" name="api_bearer_token" 
                                       class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"
                                       placeholder="Enter API bearer token for authentication">
                            </div>
                            <p class="mt-2 text-sm text-gray-500">
                                This token is required for API access and automated certificate downloads. Keep it secure!
                            </p>
                        </div>
                    </div>

                    <!-- Cache Configuration -->
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h4 class="text-lg font-medium text-gray-900 mb-4">
                            <i class="fas fa-database mr-2 text-blue-500"></i>
                            Deployment Status Cache
                        </h4>
                        <div class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="cache_ttl" class="block text-sm font-medium text-gray-700">
                                        Cache TTL (Time to Live)
                                    </label>
                                    <div class="mt-1 flex rounded-md shadow-sm">
                                        <input type="number" id="cache_ttl" name="cache_ttl" min="30" max="3600" step="30"
                                               class="block w-full border border-gray-300 rounded-l-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder="300">
                                        <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                            seconds
                                        </span>
                                    </div>
                                    <p class="mt-1 text-xs text-gray-500">
                                        How long to cache deployment status results (30-3600 seconds)
                                    </p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Cache Statistics
                                    </label>
                                    <div class="bg-white p-3 rounded border text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Cached Entries:</span>
                                            <span id="cache-entries" class="font-medium">-</span>
                                        </div>
                                        <div class="flex justify-between mt-1">
                                            <span class="text-gray-600">Current TTL:</span>
                                            <span id="cache-current-ttl" class="font-medium">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex space-x-3">
                                <button type="button" onclick="refreshCacheStats()" 
                                        class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors text-sm">
                                    <i class="fas fa-sync-alt mr-1"></i>
                                    Refresh Stats
                                </button>
                                <button type="button" onclick="clearDeploymentCache()" 
                                        class="bg-yellow-600 text-white px-4 py-2 rounded-md hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 transition-colors text-sm">
                                    <i class="fas fa-trash mr-1"></i>
                                    Clear Cache
                                </button>
                            </div>
                            <div class="bg-blue-50 border border-blue-200 rounded-md p-3">
                                <div class="flex">
                                    <div class="flex-shrink-0">
                                        <i class="fas fa-info-circle text-blue-400"></i>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm text-blue-700">
                                            The deployment status cache stores SSL certificate check results to improve performance. 
                                            Lower TTL values provide more up-to-date status but may cause slower page loads.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="flex justify-end">
                        <button type="submit" id="saveBtn" class="bg-primary text-white px-6 py-2 rounded-md hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors">
                            <i class="fas fa-save mr-2"></i>
                            Save Settings
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="statusMessage" class="mt-4 hidden"></div>
    </div>

    <script>
        // API Configuration
        const API_TOKEN = '{{ api_token }}';
        const API_HEADERS = {
            'Authorization': `Bearer ${API_TOKEN}`,
            'Content-Type': 'application/json'
        };

        // Global variables
        let currentSettings = {};
        let dnsProviders = {};

        // DOM Elements
        const form = document.getElementById('settingsForm');
        const saveBtn = document.getElementById('saveBtn');
        const statusMessage = document.getElementById('statusMessage');

        // Load settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            loadDNSProviders();
            setupEventListeners();
        });

        function setupEventListeners() {
            // DNS provider selection
            document.querySelectorAll('input[name="dns_provider"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    showDNSConfig(this.value);
                });
            });

            // Form submission
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                saveSettings();
            });
        }

        function showDNSConfig(provider) {
            // Hide all DNS config sections
            document.querySelectorAll('.dns-config').forEach(section => {
                section.classList.add('hidden');
            });

            // Show selected provider config
            const configSection = document.getElementById(provider + '-config');
            if (configSection) {
                configSection.classList.remove('hidden');
            }
        }

        function loadSettings() {
            fetch('/api/settings', {
                headers: API_HEADERS
            })
            .then(response => response.json())
            .then(data => {
                currentSettings = data;
                populateForm(data);
            })
            .catch(error => {
                console.error('Error loading settings:', error);
                showMessage('Error loading settings', 'error');
            });
        }

        function loadDNSProviders() {
            fetch('/api/settings/dns-providers', {
                headers: API_HEADERS
            })
            .then(response => response.json())
            .then(data => {
                dnsProviders = data;
                updateProviderStatus(data);
            })
            .catch(error => {
                console.error('Error loading DNS providers:', error);
            });
        }

        function updateProviderStatus(providersData) {
            const providers = providersData.available_providers || {};
            
            Object.keys(providers).forEach(provider => {
                const statusElement = document.getElementById(provider + '-status');
                if (statusElement) {
                    const configured = providers[provider].configured;
                    statusElement.textContent = configured ? 'Configured' : 'Not configured';
                    statusElement.className = configured ? 'text-xs text-green-600 mt-1' : 'text-xs text-gray-500 mt-1';
                }
            });
        }

        function populateForm(data) {
            // Basic settings
            document.getElementById('email').value = data.email || '';
            document.getElementById('domains').value = (data.domains || []).join('\n');
            document.getElementById('auto_renew').checked = data.auto_renew !== false;

            // DNS Provider
            const dnsProvider = data.dns_provider || 'cloudflare';
            const providerRadio = document.querySelector(`input[name="dns_provider"][value="${dnsProvider}"]`);
            if (providerRadio) {
                providerRadio.checked = true;
                showDNSConfig(dnsProvider);
            }

            // DNS Provider configurations
            const dnsProviders = data.dns_providers || {};
            
            // Cloudflare (backward compatibility)
            if (data.has_cloudflare_token || dnsProviders.cloudflare?.api_token) {
                document.getElementById('cloudflare_api_token').placeholder = 'Token configured (hidden)';
            }

            // Populate DNS provider fields
            Object.keys(dnsProviders).forEach(provider => {
                const config = dnsProviders[provider];
                Object.keys(config).forEach(key => {
                    const fieldId = provider + '_' + key;
                    const field = document.getElementById(fieldId);
                    if (field) {
                        if (config[key] === '***masked***') {
                            field.placeholder = 'Value configured (hidden)';
                        } else if (config[key]) {
                            field.value = config[key];
                        }
                    }
                });
            });

            // API Bearer Token
            if (data.has_api_bearer_token) {
                document.getElementById('api_bearer_token').placeholder = 'Token configured (hidden)';
            }
            
            // Cache settings
            loadCacheSettings();
            
            // Update connection status
            updateConnectionStatus(data);
        }
        
        function updateConnectionStatus(data) {
            const connectionStatus = document.getElementById('connectionStatus');
            const partialStatus = document.getElementById('partialStatus');
            const disconnectedStatus = document.getElementById('disconnectedStatus');
            
            // Hide all status indicators
            [connectionStatus, partialStatus, disconnectedStatus].forEach(el => {
                el.style.display = 'none';
            });
            
            // Check configuration completeness
            const hasEmail = data.email && data.email.length > 0;
            const hasDomains = data.domains && data.domains.length > 0;
            const hasApiToken = data.has_api_bearer_token;
            const hasDnsProvider = data.dns_provider && data.dns_providers && 
                                  Object.keys(data.dns_providers[data.dns_provider] || {}).length > 0;
            
            const completeness = [hasEmail, hasDomains, hasApiToken, hasDnsProvider].filter(Boolean).length;
            
            if (completeness === 4) {
                connectionStatus.style.display = 'flex';
            } else if (completeness > 0) {
                partialStatus.style.display = 'flex';
            } else {
                disconnectedStatus.style.display = 'flex';
            }
        }

        function saveSettings() {
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';

            // Collect form data
            const formData = new FormData(form);
            const settings = {
                email: formData.get('email'),
                domains: formData.get('domains').split('\n').filter(d => d.trim()),
                auto_renew: formData.has('auto_renew'),
                dns_provider: formData.get('dns_provider'),
                dns_providers: {}
            };

            // Collect DNS provider configurations
            const providers = [
                'cloudflare', 'route53', 'azure', 'google', 'powerdns', 'digitalocean',
                'linode', 'gandi', 'ovh', 'namecheap', 'rfc2136', 'vultr', 'dnsmadeeasy', 'nsone'
            ];
            providers.forEach(provider => {
                settings.dns_providers[provider] = {};
                
                if (provider === 'cloudflare') {
                    const token = formData.get('cloudflare_api_token');
                    if (token) settings.dns_providers[provider].api_token = token;
                } else if (provider === 'route53') {
                    const accessKey = formData.get('route53_access_key_id');
                    const secretKey = formData.get('route53_secret_access_key');
                    const region = formData.get('route53_region');
                    if (accessKey) settings.dns_providers[provider].access_key_id = accessKey;
                    if (secretKey) settings.dns_providers[provider].secret_access_key = secretKey;
                    if (region) settings.dns_providers[provider].region = region;
                } else if (provider === 'azure') {
                    const fields = ['subscription_id', 'resource_group', 'tenant_id', 'client_id', 'client_secret'];
                    fields.forEach(field => {
                        const value = formData.get(`azure_${field}`);
                        if (value) settings.dns_providers[provider][field] = value;
                    });
                } else if (provider === 'google') {
                    const projectId = formData.get('google_project_id');
                    const serviceKey = formData.get('google_service_account_key');
                    if (projectId) settings.dns_providers[provider].project_id = projectId;
                    if (serviceKey) settings.dns_providers[provider].service_account_key = serviceKey;
                } else if (provider === 'powerdns') {
                    const apiUrl = formData.get('powerdns_api_url');
                    const apiKey = formData.get('powerdns_api_key');
                    if (apiUrl) settings.dns_providers[provider].api_url = apiUrl;
                    if (apiKey) settings.dns_providers[provider].api_key = apiKey;
                } else if (provider === 'digitalocean') {
                    const token = formData.get('digitalocean_api_token');
                    if (token) settings.dns_providers[provider].api_token = token;
                } else if (provider === 'linode') {
                    const key = formData.get('linode_api_key');
                    if (key) settings.dns_providers[provider].api_key = key;
                } else if (provider === 'gandi') {
                    const token = formData.get('gandi_api_token');
                    if (token) settings.dns_providers[provider].api_token = token;
                } else if (provider === 'vultr') {
                    const key = formData.get('vultr_api_key');
                    if (key) settings.dns_providers[provider].api_key = key;
                } else if (provider === 'nsone') {
                    const key = formData.get('nsone_api_key');
                    if (key) settings.dns_providers[provider].api_key = key;
                } else if (provider === 'ovh') {
                    const endpoint = formData.get('ovh_endpoint');
                    const appKey = formData.get('ovh_application_key');
                    const appSecret = formData.get('ovh_application_secret');
                    const consumerKey = formData.get('ovh_consumer_key');
                    if (endpoint) settings.dns_providers[provider].endpoint = endpoint;
                    if (appKey) settings.dns_providers[provider].application_key = appKey;
                    if (appSecret) settings.dns_providers[provider].application_secret = appSecret;
                    if (consumerKey) settings.dns_providers[provider].consumer_key = consumerKey;
                } else if (provider === 'namecheap') {
                    const username = formData.get('namecheap_username');
                    const apiKey = formData.get('namecheap_api_key');
                    if (username) settings.dns_providers[provider].username = username;
                    if (apiKey) settings.dns_providers[provider].api_key = apiKey;
                } else if (provider === 'dnsmadeeasy') {
                    const apiKey = formData.get('dnsmadeeasy_api_key');
                    const secretKey = formData.get('dnsmadeeasy_secret_key');
                    if (apiKey) settings.dns_providers[provider].api_key = apiKey;
                    if (secretKey) settings.dns_providers[provider].secret_key = secretKey;
                } else if (provider === 'rfc2136') {
                    const nameserver = formData.get('rfc2136_nameserver');
                    const tsigKey = formData.get('rfc2136_tsig_key');
                    const tsigSecret = formData.get('rfc2136_tsig_secret');
                    const tsigAlgorithm = formData.get('rfc2136_tsig_algorithm');
                    if (nameserver) settings.dns_providers[provider].nameserver = nameserver;
                    if (tsigKey) settings.dns_providers[provider].tsig_key = tsigKey;
                    if (tsigSecret) settings.dns_providers[provider].tsig_secret = tsigSecret;
                    if (tsigAlgorithm) settings.dns_providers[provider].tsig_algorithm = tsigAlgorithm;
                } else if (provider === 'hetzner') {
                    const token = formData.get('hetzner_api_token');
                    if (token) settings.dns_providers[provider].api_token = token;
                } else if (provider === 'porkbun') {
                    const apiKey = formData.get('porkbun_api_key');
                    const secretKey = formData.get('porkbun_secret_key');
                    if (apiKey) settings.dns_providers[provider].api_key = apiKey;
                    if (secretKey) settings.dns_providers[provider].secret_key = secretKey;
                } else if (provider === 'godaddy') {
                    const apiKey = formData.get('godaddy_api_key');
                    const secret = formData.get('godaddy_secret');
                    if (apiKey) settings.dns_providers[provider].api_key = apiKey;
                    if (secret) settings.dns_providers[provider].secret = secret;
                } else if (provider === 'he-ddns') {
                    const username = formData.get('he_ddns_username');
                    const password = formData.get('he_ddns_password');
                    if (username) settings.dns_providers[provider].username = username;
                    if (password) settings.dns_providers[provider].password = password;
                } else if (provider === 'dynudns') {
                    const token = formData.get('dynudns_token');
                    if (token) settings.dns_providers[provider].token = token;
                }
            });

            // API Bearer Token
            const apiToken = formData.get('api_bearer_token');
            if (apiToken) {
                settings.api_bearer_token = apiToken;
            }

            // Backward compatibility for Cloudflare
            if (settings.dns_providers.cloudflare?.api_token) {
                settings.cloudflare_token = settings.dns_providers.cloudflare.api_token;
            }

            fetch('/api/settings', {
                method: 'POST',
                headers: API_HEADERS,
                body: JSON.stringify(settings)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage('Settings saved successfully!', 'success');
                    loadDNSProviders(); // Refresh provider status
                } else {
                    showMessage(data.message || 'Error saving settings', 'error');
                }
            })
            .catch(error => {
                console.error('Error saving settings:', error);
                showMessage('Error saving settings', 'error');
            })
            .finally(() => {
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Save Settings';
            });
        }

        function showMessage(message, type) {
            const colors = {
                success: 'bg-green-100 border-green-400 text-green-700',
                error: 'bg-red-100 border-red-400 text-red-700',
                info: 'bg-blue-100 border-blue-400 text-blue-700'
            };

            statusMessage.className = `border-l-4 p-4 transform transition-all duration-300 ${colors[type] || colors.info}`;
            statusMessage.innerHTML = `
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium">${message}</p>
                        ${type === 'success' ? '<p class="text-xs mt-1 opacity-75">Changes have been saved successfully</p>' : ''}
                    </div>
                </div>
            `;
            statusMessage.classList.remove('hidden');

            // Add subtle animation
            setTimeout(() => {
                statusMessage.style.transform = 'translateX(0)';
            }, 10);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                statusMessage.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    statusMessage.classList.add('hidden');
                }, 300);
            }, 5000);
        }

        // Cache Management Functions
        function loadCacheSettings() {
            try {
                const savedSettings = localStorage.getItem('deployment-cache-settings');
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    const ttlSeconds = Math.round((settings.ttl || 300000) / 1000);
                    document.getElementById('cache_ttl').value = ttlSeconds;
                } else {
                    document.getElementById('cache_ttl').value = 300; // 5 minutes default
                }
                refreshCacheStats();
            } catch (error) {
                console.error('Error loading cache settings:', error);
                document.getElementById('cache_ttl').value = 300; // 5 minutes default
            }
        }

        function saveCacheSettings() {
            const ttlSeconds = parseInt(document.getElementById('cache_ttl').value) || 300;
            const ttlMs = ttlSeconds * 1000;
            
            try {
                // Save to localStorage (this will be picked up by the cache system on the main page)
                localStorage.setItem('deployment-cache-settings', JSON.stringify({ ttl: ttlMs }));
                
                // Also notify any open main pages to update their cache settings
                localStorage.setItem('cache-settings-updated', Date.now().toString());
                
                showMessage(`Cache TTL updated to ${ttlSeconds} seconds`, 'success');
                setTimeout(refreshCacheStats, 500);
            } catch (error) {
                console.error('Error saving cache settings:', error);
                showMessage('Error saving cache settings', 'error');
            }
        }

        function refreshCacheStats() {
            try {
                const savedSettings = localStorage.getItem('deployment-cache-settings');
                let ttlSeconds = 300; // default
                
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    ttlSeconds = Math.round((settings.ttl || 300000) / 1000);
                }
                
                // We can't directly access the cache from the settings page,
                // but we can show the configured TTL
                document.getElementById('cache-entries').textContent = 'N/A (main page only)';
                document.getElementById('cache-current-ttl').textContent = `${ttlSeconds}s`;
                
                // If there's a way to get cache stats from the main page via postMessage or similar,
                // we could implement that here. For now, we show what we can.
                
            } catch (error) {
                console.error('Error refreshing cache stats:', error);
                document.getElementById('cache-entries').textContent = 'Error';
                document.getElementById('cache-current-ttl').textContent = 'Error';
            }
        }

        function clearDeploymentCache() {
            if (confirm('Are you sure you want to clear the deployment status cache? This will force a refresh of all certificate deployment statuses.')) {
                try {
                    // Signal main page to clear cache
                    localStorage.setItem('clear-deployment-cache', Date.now().toString());
                    showMessage('Cache clear signal sent. Refresh the main page to see the effect.', 'info');
                    setTimeout(refreshCacheStats, 500);
                } catch (error) {
                    console.error('Error clearing cache:', error);
                    showMessage('Error clearing cache', 'error');
                }
            }
        }

        // Update the saveSettings function to include cache settings
        function saveSettings() {
            const formData = new FormData(form);
            
            const saveBtn = document.getElementById('saveBtn');
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';

            // Convert form data to object
            const settings = {};
            
            // Basic settings
            settings.email = formData.get('email');
            settings.domains = formData.get('domains').split('\n').filter(domain => domain.trim());
            settings.auto_renew = formData.has('auto_renew');
            settings.dns_provider = formData.get('dns_provider');

            // DNS provider configurations
            settings.dns_providers = {};
            const dnsProvider = settings.dns_provider;
            
            if (dnsProvider === 'cloudflare') {
                const token = formData.get('cloudflare_api_token');
                if (token) {
                    settings.dns_providers.cloudflare = { api_token: token };
                }
            } else if (dnsProvider === 'route53') {
                const accessKey = formData.get('route53_access_key_id');
                const secretKey = formData.get('route53_secret_access_key');
                const region = formData.get('route53_region');
                if (accessKey && secretKey) {
                    settings.dns_providers.route53 = {
                        access_key_id: accessKey,
                        secret_access_key: secretKey,
                        region: region || 'us-east-1'
                    };
                }
            } else if (dnsProvider === 'azure') {
                const subscriptionId = formData.get('azure_subscription_id');
                const resourceGroup = formData.get('azure_resource_group');
                const tenantId = formData.get('azure_tenant_id');
                const clientId = formData.get('azure_client_id');
                const clientSecret = formData.get('azure_client_secret');
                if (subscriptionId && resourceGroup && tenantId && clientId && clientSecret) {
                    settings.dns_providers.azure = {
                        subscription_id: subscriptionId,
                        resource_group: resourceGroup,
                        tenant_id: tenantId,
                        client_id: clientId,
                        client_secret: clientSecret
                    };
                }
            } else if (dnsProvider === 'google') {
                const projectId = formData.get('google_project_id');
                const serviceAccountKey = formData.get('google_service_account_key');
                if (projectId && serviceAccountKey) {
                    settings.dns_providers.google = {
                        project_id: projectId,
                        service_account_key: serviceAccountKey
                    };
                }
            } else if (dnsProvider === 'powerdns') {
                const apiUrl = formData.get('powerdns_api_url');
                const apiKey = formData.get('powerdns_api_key');
                if (apiUrl && apiKey) {
                    settings.dns_providers.powerdns = {
                        api_url: apiUrl,
                        api_key: apiKey
                    };
                }
            } else if (dnsProvider === 'digitalocean') {
                const token = formData.get('digitalocean_api_token');
                if (token) {
                    settings.dns_providers.digitalocean = { api_token: token };
                }
            } else if (dnsProvider === 'linode') {
                const key = formData.get('linode_api_key');
                if (key) {
                    settings.dns_providers.linode = { api_key: key };
                }
            } else if (dnsProvider === 'gandi') {
                const token = formData.get('gandi_api_token');
                if (token) {
                    settings.dns_providers.gandi = { api_token: token };
                }
            } else if (dnsProvider === 'ovh') {
                const endpoint = formData.get('ovh_endpoint');
                const appKey = formData.get('ovh_application_key');
                const appSecret = formData.get('ovh_application_secret');
                const consumerKey = formData.get('ovh_consumer_key');
                if (endpoint && appKey && appSecret && consumerKey) {
                    settings.dns_providers.ovh = {
                        endpoint: endpoint,
                        application_key: appKey,
                        application_secret: appSecret,
                        consumer_key: consumerKey
                    };
                }
            } else if (dnsProvider === 'namecheap') {
                const username = formData.get('namecheap_username');
                const apiKey = formData.get('namecheap_api_key');
                if (username && apiKey) {
                    settings.dns_providers.namecheap = {
                        username: username,
                        api_key: apiKey
                    };
                }
            } else if (dnsProvider === 'vultr') {
                const key = formData.get('vultr_api_key');
                if (key) {
                    settings.dns_providers.vultr = { api_key: key };
                }
            } else if (dnsProvider === 'dnsmadeeasy') {
                const apiKey = formData.get('dnsmadeeasy_api_key');
                const secretKey = formData.get('dnsmadeeasy_secret_key');
                if (apiKey && secretKey) {
                    settings.dns_providers.dnsmadeeasy = {
                        api_key: apiKey,
                        secret_key: secretKey
                    };
                }
            } else if (dnsProvider === 'nsone') {
                const key = formData.get('nsone_api_key');
                if (key) {
                    settings.dns_providers.nsone = { api_key: key };
                }
            } else if (dnsProvider === 'rfc2136') {
                const nameserver = formData.get('rfc2136_nameserver');
                const tsigKey = formData.get('rfc2136_tsig_key');
                const tsigSecret = formData.get('rfc2136_tsig_secret');
                const tsigAlgorithm = formData.get('rfc2136_tsig_algorithm');
                if (nameserver && tsigKey && tsigSecret) {
                    settings.dns_providers.rfc2136 = {
                        nameserver: nameserver,
                        tsig_key: tsigKey,
                        tsig_secret: tsigSecret
                    };
                    if (tsigAlgorithm) {
                        settings.dns_providers.rfc2136.tsig_algorithm = tsigAlgorithm;
                    }
                }
            }

            // API Bearer Token
            const apiToken = formData.get('api_bearer_token');
            if (apiToken) {
                settings.api_bearer_token = apiToken;
            }

            // Save cache settings separately (they're handled on client-side)
            saveCacheSettings();

            fetch('/api/settings', {
                method: 'POST',
                headers: API_HEADERS,
                body: JSON.stringify(settings)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage('Settings saved successfully!', 'success');
                    loadDNSProviders(); // Refresh provider status
                } else {
                    showMessage(data.message || 'Error saving settings', 'error');
                }
            })
            .catch(error => {
                console.error('Error saving settings:', error);
                showMessage('Error saving settings', 'error');
            })
            .finally(() => {
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Save Settings';
            });
        }

        // Load settings when page loads
        loadSettings();
    </script>
</body>
</html>
